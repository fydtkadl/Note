# **fastbin-dup_into_stack**

## **Exploit Plan**

1. 동일한 크기의 Fast Chunk 3개 생성한다.
1. 첫 번째 Fast Chunk 해제한다.
1. 두 번째 Fast Chunk 해제한다.
1. 첫 번째 Fast Chunk 해제한다
1. 이전과 동일한 크기로 힙을 할당하고 **Fake Chunk** 쓴다.
1. 동일한 크기로 Fast Chunk 2개 생성한다.
1. 다음에 할당하는 영역에 원하는 값 쓴다.

A -> B -> A 로 해제하는 이유는 동일한 공간을 연속으로 해제하는 경우 double free or corruption이 발생하기 때문이다.

5번째에 동일한 크기로 힙을 할당하는 경우 첫 번째 A가 할당되는데 여기에 값을 쓸 수 있다면 Fake Chunk로 조작이 가능하다.

![fastbin_dup_malloc](/Resources/img/fastbin_dup_malloc.png)

원래 세 번째 A의 FD 값에는 아무 값도 없기 때문에 다음 청크가 없었지만, 첫 번째 A가 할당되면서 FD, BK 부분이 데이터 영역으로 변했고, Fake Chunk 값을 쓰면 세 번째 A의 FD가 변조된다.  

Fake Chunk의 조건

* 이전 Chunk의 Size와 Fake Chunk의 Size가 동일해야 함
* 우리가 변조하고자 하는 주소보다 작은 주소에 위치해야 함

**References**  
<>